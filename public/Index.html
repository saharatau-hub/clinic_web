<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Clinic Web App ‚Äì OPD Card Generator</title>
  <style>
    body { font-family: sans-serif; max-width: 960px; margin: 40px auto; line-height: 1.5; }
    h1 { color: #2563eb; }
    textarea { width: 100%; height: 200px; padding: 8px; border: 1px solid #ccc; border-radius: 8px; }
    button { margin-top: 8px; padding: 8px 12px; border: none; border-radius: 8px; cursor: pointer; }
    .primary { background: #2563eb; color: white; }
    select, input[type="file"] { margin-top: 10px; padding: 6px; }
    .output { margin-top: 20px; border: 1px solid #ccc; border-radius: 8px; padding: 10px; background: #f9f9f9; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>üß† Clinic Web App</h1>
  <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏á/‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö OPD Card ‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å</p>

  <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Template:</label>
  <select id="template">
    <option value="internal">‡∏≠‡∏≤‡∏¢‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°</option>
    <option value="neurology">‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ó‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤</option>
    <option value="pediatrics">‡∏Å‡∏∏‡∏°‡∏≤‡∏£‡πÄ‡∏ß‡∏ä</option>
    <option value="pt">‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏ö‡∏≥‡∏ö‡∏±‡∏î</option>
    <option value="neurosurgery">‡∏®‡∏±‡∏•‡∏¢‡∏Å‡∏£‡∏£‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ó</option>
    <option value="ophthalmology">‡∏à‡∏±‡∏Å‡∏©‡∏∏</option>
    <option value="soap">SOAP Note</option>
  </select>

  <h3>1Ô∏è‚É£ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á</h3>
  <input type="file" id="file" accept="audio/*">
  <button id="uploadBtn" class="primary">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏™‡∏£‡∏∏‡∏õ</button>

  <h3>2Ô∏è‚É£ ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏≠‡∏á</h3>
  <textarea id="text" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏£‡∏∏‡∏õ..."></textarea>
  <button id="summarizeBtn" class="primary">‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>

  <h3>üìÑ ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</h3>
  <div id="result" class="output">‡∏£‡∏≠‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå...</div>

  <script>
    const summarizeBtn = document.getElementById('summarizeBtn');
    const uploadBtn = document.getElementById('uploadBtn');
    const fileInput = document.getElementById('file');
    const textInput = document.getElementById('text');
    const resultDiv = document.getElementById('result');
    const templateSel = document.getElementById('template');

    async function summarizeText() {
      const text = textInput.value.trim();
      const template = templateSel.value;
      if (!text) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°');
      resultDiv.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡∏∏‡∏õ...';
      const res = await fetch('/summarize-from-text', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ text, template })
      });
      const data = await res.json();
      resultDiv.textContent = data.ok ? data.summary : '‚ùå ' + data.error;
    }

    async function uploadFile() {
      const file = fileInput.files[0];
      if (!file) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á');
      const template = templateSel.value;
      const fd = new FormData();
      fd.append('audio', file);
      resultDiv.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏™‡∏£‡∏∏‡∏õ...';
      const res = await fetch(`/upload-audio-and-summarize?template=${template}`, { method: 'POST', body: fd });
      const data = await res.json();
      resultDiv.textContent = data.ok ? data.summary : '‚ùå ' + data.error;
    }

    summarizeBtn.onclick = summarizeText;
    uploadBtn.onclick = uploadFile;
  </script>
</body>
</html>
