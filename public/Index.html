<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Clinic Web ‚Äì OPD Card</title>
  <style>
    body { font-family: system-ui, Segoe UI, Arial, sans-serif; max-width: 960px; margin: 36px auto; padding: 0 16px; line-height: 1.5; }
    h1 { color: #2563eb; }
    textarea { width: 100%; height: 200px; padding: 10px; border: 1px solid #d1d5db; border-radius: 10px; }
    select, input[type=file], button { margin-top: 8px; }
    .btn { padding: 8px 12px; border-radius: 8px; border: 0; cursor: pointer; }
    .primary { background:#2563eb; color:#fff; }
    .out { white-space: pre-wrap; background:#f9fafb; border:1px solid #e5e7eb; border-radius:10px; padding:12px; margin-top:12px; }
  </style>
</head>
<body>
  <h1>üß† Clinic Web ‚Äì OPD Card</h1>
  <p>‡∏ñ‡πâ‡∏≤‡πÄ‡∏´‡πá‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</p>

  <label>Template:</label>
  <select id="template">
    <option value="internal">‡∏≠‡∏≤‡∏¢‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°</option>
    <option value="neurology">‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ó‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤</option>
    <option value="soap">SOAP</option>
    <option value="pt">‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏ö‡∏≥‡∏ö‡∏±‡∏î</option>
    <option value="neurosurgery">‡∏®‡∏±‡∏•‡∏¢‡∏Å‡∏£‡∏£‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ó</option>
    <option value="ophthalmology">‡∏à‡∏±‡∏Å‡∏©‡∏∏</option>
  </select>

  <h3>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á</h3>
  <input id="file" type="file" accept="audio/*" />
  <button id="uploadBtn" class="btn primary">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏™‡∏£‡∏∏‡∏õ</button>

  <h3>‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</h3>
  <textarea id="text" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡∏∏‡∏õ‚Ä¶"></textarea><br/>
  <button id="sumBtn" class="btn primary">‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>

  <h3>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</h3>
  <div id="out" class="out">‡∏£‡∏≠‡∏ú‡∏•‚Ä¶</div>

<script>
const T = () => document.getElementById('template').value;
const out = document.getElementById('out');

document.getElementById('sumBtn').onclick = async () => {
  const text = document.getElementById('text').value.trim();
  if (!text) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°');
  out.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡∏∏‡∏õ‚Ä¶';
  const r = await fetch('/summarize-from-text', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ text, template: T() })
  });
  const j = await r.json();
  out.textContent = j.ok ? j.summary : '‚ùå ' + j.error;
};

document.getElementById('uploadBtn').onclick = async () => {
  const f = document.getElementById('file').files[0];
  if (!f) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á');
  out.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ñ‡∏≠‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‚Ä¶';
  const fd = new FormData(); fd.append('audio', f);
  const r = await fetch('/upload-audio-and-summarize?template=' + encodeURIComponent(T()), {
    method: 'POST', body: fd
  });
  const j = await r.json();
  out.textContent = j.ok ? j.summary : '‚ùå ' + j.error;
};
</script>
</body>
</html>
